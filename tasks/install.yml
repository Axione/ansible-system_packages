---
### REDHAT 7 Install base repositories
- when: ansible_distribution == "RedHat" and ansible_distribution_major_version == "7"
  block:
    - name: Enable rhel-7-server-extras-rpms
      community.general.rhsm_repository:
        name: rhel-7-server-extras-rpms
        state: enabled

    - name: Install dnf package
      yum:
        name: dnf
        state: present

- name: Import EPEL GPG key.
  rpm_key:
    key: "https://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-{{ ansible_distribution_major_version }}"
    state: present
  when: ansible_os_family == 'RedHat' or ansible_os_family == 'Rocky'

- name: REDHAT | Install EPEL repository
  yum:
    name: "https://dl.fedoraproject.org/pub/epel/epel-release-latest-{{ ansible_distribution_major_version }}.noarch.rpm"
    state: present
  when: ansible_os_family == 'RedHat' or ansible_os_family == 'Rocky'

- name: DEBIAN | Install base packages
  package:
    name: "{{ item }}"
    state: present
    update_cache: true
  with_items:
    - "{{ base_packages_common }}"
    - "{{ base_packages_release_specific }}"
    - "{{ base_packages_extra }}"
  when: ansible_distribution == 'Debian'

- name: REDHAT | Install base packages
  yum:
    name: "{{ base_packages_common  + base_packages_release_specific + base_packages_extra }}"
    state: present
  when: ansible_os_family == 'RedHat' or ansible_os_family == 'Rocky'
