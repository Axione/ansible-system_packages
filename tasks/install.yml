---
### REDHAT 7 Install base repositories
- name: "REDHAT 7 | Install extra repositories"
  when: ansible_os_family in ["RedHat", "Rocky", "OracleLinux"]
  block:
    - name: "REDHAT | Import EPEL GPG key."
      ansible.builtin.rpm_key:
        key: "https://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-{{ ansible_distribution_major_version }}"
        state: present

    - name: "REDHAT | Installing epel-release"
      ansible.builtin.yum:
        name: "https://dl.fedoraproject.org/pub/epel/epel-release-latest-{{ ansible_distribution_major_version }}.noarch.rpm"
        state: present

    - name: "REDHAT | Installing dnf package"
      ansible.builtin.yum:
        name: dnf
        state: present

        #- name: "REDHAT | Enable rhel-x-server-extras-rpms"
        #  community.general.rhsm_repository:
        #    name: "rhel-{{ ansible_distribution_major_version }}-server-extras-rpms"
        #    state: enabled

- name: "DEBIAN | Install base packages"
  ansible.builtin.package:
    name: "{{ item }}"
    state: present
    update_cache: true
  with_items:
    - "{{ base_packages_common }}"
    - "{{ base_packages_release_specific }}"
    - "{{ base_packages_extra }}"
  when: ansible_os_family == 'Debian'

- name: "REDHAT | Install base packages"
  ansible.builtin.yum:
    name: "{{ base_packages_common  + base_packages_release_specific + base_packages_extra }}"
    state: present
  when: ansible_os_family in ["RedHat", "Rocky", "OracleLinux"]
