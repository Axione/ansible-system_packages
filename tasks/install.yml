---
### REDHAT families Install repositories
- name: "REDHAT | Install extra repositories"
  when: ansible_os_family in ["RedHat", "Rocky", "OracleLinux"]
  block:
    - name: "REDHAT | Import EPEL GPG key."
      ansible.builtin.rpm_key:
        key: "https://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-{{ ansible_distribution_major_version }}"
        state: present

    - name: "REDHAT | Installing epel-release"
      ansible.builtin.yum:
        name: "https://dl.fedoraproject.org/pub/epel/epel-release-latest-{{ ansible_distribution_major_version }}.noarch.rpm"
        state: present

    - name: "OracleLinux | Installing oracle-epel-release-el7"
      ansible.builtin.yum:
        name: "oracle-epel-release-el7"
        state: present
      when: ansible_distribution == "OracleLinux" and ansible_distribution_major_version == "7"

- name: "DEBIAN | Install packages"
  ansible.builtin.package:
    name: "{{ packages_common  + packages_family + packages_distrib + packages_distrib_version + packages_extra }}"
    state: present
    update_cache: true
  when: ansible_os_family == 'Debian'

- name: "REDHAT | Install packages"
  ansible.builtin.yum:
    name: "{{ packages_common  + packages_family + packages_distrib + packages_distrib_version + packages_extra }}"
    state: present
  when: ansible_os_family in ["RedHat", "Rocky", "OracleLinux"]

- name: "DEBIAN | Remove packages"
  ansible.builtin.package:
    name: "{{ packages_rm_common  + packages_rm_family + packages_rm_distrib + packages_rm_distrib_version + packages_rm_extra }}"
    state: present
    update_cache: true
  when: ansible_os_family == 'Debian'

- name: "REDHAT | Remove packages"
  ansible.builtin.yum:
    name: "{{ packages_rm_common  + packages_rm_family + packages_rm_distrib + packages_rm_distrib_version + packages_rm_extra }}"
    state: present
  when: ansible_os_family in ["RedHat", "Rocky", "OracleLinux"]
